using System;
using System.Collections.Generic;
using BEx.ExchangeEngine.API;
using BEx.ExchangeEngine.Utilities;

namespace BEx.Exchanges.Gdax.API.Models
{
    internal class OrderBookModel : IExchangeResponseIntermediate<OrderBook>
    {
        public int sequence { get; set; }
        public object[][] bids { get; set; }
        public object[][] asks { get; set; }

        public OrderBook Convert(TradingPair pair)
        {
            var timestamp = (long) DateTime.UtcNow.ToUnixTime();
            var ask = new List<OrderBookEntry>();

            foreach (var entry in asks)
            {
                ask.Add(new OrderBookEntry(
                    Conversion.ToDecimalInvariant(entry[1].ToString()),
                    Conversion.ToDecimalInvariant(entry[0].ToString()),
                    timestamp,
                    ExchangeType.Gdax));
            }

            var bid = new List<OrderBookEntry>();
            foreach (var entry in bids)
            {
                bid.Add(
                    new OrderBookEntry(Conversion.ToDecimalInvariant(entry[1].ToString()),
                        Conversion.ToDecimalInvariant(entry[0].ToString()),
                        timestamp,
                        ExchangeType.Gdax));
            }

            return new OrderBook(bid, ask, timestamp.ToDateTimeUTC(), ExchangeType.Gdax, pair);
        }
    }
}

/*{"sequence":612377558,"bids":[["372.37","1.07466495",4],["372.36","0.06656576",2],["372.34","0.01",1],["372.33","0.288",2],["372.32","0.04",2],["372.31","0.346",3],["372.3","0.571",4],["372.29","0.129",3],["372.28","0.04",2],["372.27","0.04",2],["372.26","9.44184",4],["372.25","0.04",2],["372.24","0.04",2],["372.23","0.112",3],["372.22","0.04",2],["372.21","0.301",3],["372.2","0.02",1],["372.19","0.02",1],["372.18","0.279",3],["372.17","0.04",2],["372.16","0.02",1],["372.15","0.02",1],["372.12","0.271",1],["372.09","0.273",1],["372.06","0.264",1],["372.05","0.02",1],["372.04","0.01815974",1],["372.03","0.271",2],["372.02","0.04",2],["372.01","0.00436199",1],["372","0.269",1],["371.99","0.281",1],["371.97","0.26",1],["371.96","1.464",2],["371.95","0.04",2],["371.94","0.267",1],["371.92","2.2423345",3],["371.91","25.254",2],["371.89","0.093",1],["371.85","0.02",1],["371.8","0.02",1],["371.75","0.02",1],["371.7","10.68712",1],["371.69","3.944",1],["371.65","0.04",2],["371.61","1.35",1],["371.57","0.02",1],["371.55","0.02",1],["371.51","11.229",2],["371.5","50.02",2]],"asks":[["372.38","0.04",2],["372.41","1.61925378",2],["372.44","0.745",3],["372.45","0.02",1],["372.47","0.00322",1],["372.48","9.3568",1],["372.5","0.98625378",3],["372.51","11.78809001",3],["372.53","0.01",1],["372.54","1.277",1],["372.55","0.02",1],["372.57","1.657",2],["372.58","0.59",3],["372.59","0.56925378",1],["372.6","1.305",2],["372.63","1.318",1],["372.65","0.02",1],["372.66","1.301",1],["372.67","1.04925378",2],["372.69","1.261",1],["372.72","1.298",1],["372.73","0.24",1],["372.74","5.133",2],["372.75","1.289",2],["372.76","0.56925378",1],["372.78","1.269",1],["372.8","1",1],["372.81","1.245",1],["372.83","0.24",1],["372.84","0.35",2],["372.85","0.02",1],["372.91","1.35",1],["372.92","4.321",1],["372.94","3.37153",5],["372.95","1.96",3],["372.96","6.5",3],["372.97","18.6486",3],["372.98","5.28",1],["372.99","0.48",1],["373","50.66532157",2],["373.01","24.63488",1],["373.04","10.69229",1],["373.05","0.02",1],["373.08","23.031",1],["373.09","4.872",1],["373.15","0.02",1],["373.27","5.029",1],["373.35","0.02",1],["373.4","1",1],["373.42","25",1]]}
*/